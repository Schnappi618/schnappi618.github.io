<!DOCTYPE html>
<html lang="zh">
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    
    <title>
        docker-compose定制clickhouse配置启动 | 国家一级保护废物
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <link rel="shortcut icon" href="/images/favicon.png">
    
    
<link rel="stylesheet" href="/css/style.css">

    <script id="hexo-configurations">
    let CONFIG = {"hostname":"schnappi618.github.io","root":"/","localsearch":{"enable":true,"trigger":"auto","unescape":false,"preload":false},"themeInfo":{"name":"ILS","version":"1.1.2","author":"XPoet","repository":"https://github.com/XPoet/hexo-theme-ils"},"path":"search.json"};
  </script>
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="国家一级保护废物" type="application/atom+xml"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>


<body>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="page-template">
    <div class="page-top">
        <header class="header-wrapper">

    <div class="header-progress"></div>

    <div class="header-content">

        <a class="logo-title" href="/">
            国家一级保护废物
        </a>

        <ul class="menu-list">
            
                <li class="menu-item">
                    <a class=""
                       href="/"
                    >
                        HOME
                    </a>
                </li>
            
                <li class="menu-item">
                    <a class=""
                       href="/archives"
                    >
                        ARCHIVES
                    </a>
                </li>
            
                <li class="menu-item">
                    <a class=""
                       href="/links"
                    >
                        LINKS
                    </a>
                </li>
            
                <li class="menu-item">
                    <a class=""
                       href="/about"
                    >
                        ABOUT
                    </a>
                </li>
            
        </ul>

        <div class="menu-bar">
            <div class="menu-bar-middle"></div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item">
                    <a class=""
                       href="/links">LINKS</a>
                </li>
            
                <li class="drawer-menu-item">
                    <a class=""
                       href="/about">ABOUT</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


    </div>

    <div class="page-middle ">

        <main class="main-content normal-code-theme">

            <div class="main-content-left">
                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <h3><a class="title-hover-animation">docker-compose定制clickhouse配置启动</a></h3>
        </div>

        <div class="meta-info">
            <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa fa-calendar-o"></i> 2020-03-28 21:35:07
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fa fa-folder"></i>
            <ul>
                
                    <li>
                        <a href="/categories/clickhouse/">clickhouse</a>
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa fa-tags"></i>
            <ul>
                
                    <li>
                        <a href="/tags/clickhouse/">clickhouse</a>
                    </li>
                
                    <li>
                        | <a href="/tags/docker/">docker</a>
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fa fa-eye"></i> <span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>
        </div>

        <div class="article-content markdown-body">
            <p>​        上一篇介绍<a href="https://schnappi618.github.io/2020/03/21/clickhouse%E7%9A%84docker%E6%9E%B6%E6%9E%84/">clickhouse的docker架构</a>中通过剥离ClickHouse提供的官方docker代码中server的必需代码打包了一个完整的clickhouse的镜像，但启动之后的配置文件都是默认的，http、MySQL访问接口以及用户权限等都未进行设置，其clickhouse服务在环境中相当于裸奔状态，本文将通过docker-compose设置clickhouse的配置文件、用户设置等来完成其定制化启动。</p>
<p><strong>参考文档：</strong></p>
<ul>
<li><a href="https://docs.docker.com/compose/" target="_blank" rel="noopener">docker-compose官方文档</a></li>
<li><a href="https://clickhouse.tech/docs/zh/operations/server_settings/settings/" target="_blank" rel="noopener">clickhouse-server设置文档</a></li>
</ul>
<h2 id="一、docker-compose简介"><a href="#一、docker-compose简介" class="headerlink" title="一、docker-compose简介"></a>一、docker-compose简介</h2><h3 id="1、什么是docker-compose"><a href="#1、什么是docker-compose" class="headerlink" title="1、什么是docker-compose"></a>1、什么是docker-compose</h3><p>​        docker-compose是一个用户定义并运行多个容器的Docker工具，可以通过YAML文件配置服务，并通过命令按照文件配置启动该服务。</p>
<p>​        <strong>docker-compose一般使用的步骤：</strong></p>
<ul>
<li><p>使用Dockerfile或打包好的docker镜像作为应用程序的基础环境</p>
</li>
<li><p>docker-compose.yml文件定义构成应用程序的服务，例如：网络环境，端口等情况</p>
</li>
<li><p>执行<code>docker-compose up</code>命令启动并运行应用程序</p>
</li>
</ul>
<h3 id="2、docker-compose安装"><a href="#2、docker-compose安装" class="headerlink" title="2、docker-compose安装"></a>2、docker-compose安装</h3><p>​        若为windows或mac安装了docker desktop版本，均已经自带了docker-compose命令，直接使用即可，若为其他CentOS或ubuntu等的linux版本，安装docker以后还需要另外安装docker-compose命令(目前最新的稳定版本为1.25.4，所以下面的安装方法为1.25.4版本，后续若需要最新的版本，可到<a href="https://github.com/docker/compose/releases" target="_blank" rel="noopener">docker-compose的github网站上</a>安装即可)，安装方法为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://github.com/docker/compose/releases/download/1.25.4/docker-compose-`uname -s`-`uname -m` -o /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line">chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure>



<h2 id="二、docker-compose定制clickhouse配置"><a href="#二、docker-compose定制clickhouse配置" class="headerlink" title="二、docker-compose定制clickhouse配置"></a>二、docker-compose定制clickhouse配置</h2><h3 id="1、文件结构"><a href="#1、文件结构" class="headerlink" title="1、文件结构"></a>1、文件结构</h3><p>​        新建一个目录用来放置docker-compose启动clickhouse的配置文件等信息，具体文件结构如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">┌─[bulubulu@localhost] - [~/clickhouse/docker_compose] - [2020-03-28 10:01:47]</span><br><span class="line">└─[0] &lt;&gt; tree .</span><br><span class="line">.</span><br><span class="line">├── config.xml</span><br><span class="line">├── data</span><br><span class="line">├── docker-compose.yml</span><br><span class="line">├── <span class="built_in">log</span></span><br><span class="line">│   ├── clickhouse-server.err.log</span><br><span class="line">│   └── clickhouse-server.log</span><br><span class="line">└── users.xml</span><br><span class="line"><span class="comment">## config.xml：clickhouse-server的配置文件</span></span><br><span class="line"><span class="comment">## data：利用docker启动clickhouse后的数据目录</span></span><br><span class="line"><span class="comment">## docker-compose.yml：docker-compose的配置文件</span></span><br><span class="line"><span class="comment">## log：日志目录</span></span><br><span class="line"><span class="comment">## user.xml：clickhouse-server的用户配置文件</span></span><br></pre></td></tr></table></figure>

<h3 id="2、docker-compose-yml文件内容"><a href="#2、docker-compose-yml文件内容" class="headerlink" title="2、docker-compose.yml文件内容"></a>2、docker-compose.yml文件内容</h3><p>​        docker-compose.yml为compose的核心，该文件的大部分指令均与<code>docker run</code>相关参数含义类似。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">	<span class="comment"># 服务名称为：clickhouse-server</span></span><br><span class="line">  <span class="attr">clickhouse-server:</span></span><br><span class="line">  	<span class="comment"># image：指定镜像，可以为镜像名称或镜像id，如果本地没有该镜像，compose会尝试pull该镜像</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">clickhouse-server-demo:1.0</span></span><br><span class="line">    <span class="comment"># container_name：指定容器名称，默认为 项目名称_服务名称_序号 的格式</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">clickhouse-server_1</span></span><br><span class="line">    <span class="comment"># hostname：指定容器主机名</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">clickhouse-server_1</span></span><br><span class="line">    <span class="comment"># networks配置该容器连接的网络，指定到文件末尾定义的networks</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">test-bridge</span></span><br><span class="line">    <span class="comment"># ports：暴露端口信息，格式为 宿主机端口:容器端口；仅指定容器端口时，宿主机会随机选择端口，类似于docker run -p</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"8123:8123"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"9000:9000"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"9004:9004"</span></span><br><span class="line">    <span class="comment"># expose：暴露端口，但不映射到宿主机，所以外部无法访问该端口，仅能容器内部访问使用</span></span><br><span class="line">    <span class="attr">expose:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9009</span></span><br><span class="line">    <span class="comment"># volumes：数据卷挂载路径设置，类似于docker run --volumn=hostdir:containerDir，也可指定文件权限</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">    <span class="comment"># 例如：将当前目录下的config.xml文件映射到容器中的/etc/clickhouse-server/config.xml文件</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./config.xml:/etc/clickhouse-server/config.xml</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./users.xml:/etc/clickhouse-server/users.xml</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/var/lib/clickhouse</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./log/clickhouse-server.log:/var/log/clickhouse-server/clickhouse-server.log</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./log/clickhouse-server.err.log:/var/log/clickhouse-server/clickhouse-server.err.log</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line"><span class="comment"># networks名称为test-bridge，和上面services中networks下的名称对应</span></span><br><span class="line">  <span class="attr">test-bridge:</span></span><br><span class="line">  <span class="comment"># external表示compose启动时会找到名为docker-compose-default的已存在的网络，若未找到该网络，则docker-compose up启动时会报错，同时通过 docker network ls 查看本地目前有哪些网络</span></span><br><span class="line">    <span class="attr">external:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">docker_compose_default</span></span><br></pre></td></tr></table></figure>

<h3 id="3、config-xml文件内容"><a href="#3、config-xml文件内容" class="headerlink" title="3、config.xml文件内容"></a>3、config.xml文件内容</h3><p>​        从docker-compose.yml文件中可以看出，该文件其实为clickhose-server的配置文件，本次基本使用了一些默认的配置，对clickhouse-server配置文件的解释可参考<a href="%5Bhttps://schnappi618.github.io/2020/03/28/clickhouse-server%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/%5D(https://schnappi618.github.io/2020/03/28/clickhouse-server%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/)">clickhouse-server配置文件详解</a>，该文件内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span>&gt;</span>trace<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">log</span>&gt;</span>/var/log/clickhouse-server/clickhouse-server.log<span class="tag">&lt;/<span class="name">log</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">errorlog</span>&gt;</span>/var/log/clickhouse-server/clickhouse-server.err.log<span class="tag">&lt;/<span class="name">errorlog</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">size</span>&gt;</span>1000M<span class="tag">&lt;/<span class="name">size</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">count</span>&gt;</span>10<span class="tag">&lt;/<span class="name">count</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">http_port</span>&gt;</span>8123<span class="tag">&lt;/<span class="name">http_port</span>&gt;</span>   <span class="comment">&lt;!-- 通过url访问clickhouse的端口号 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tcp_port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">tcp_port</span>&gt;</span>     <span class="comment">&lt;!-- 通过tcp访问clickhouse的端口号 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql_port</span>&gt;</span>9004<span class="tag">&lt;/<span class="name">mysql_port</span>&gt;</span>  <span class="comment">&lt;!-- 通过mysql访问clickhouse的端口号 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- For HTTPS and SSL over native protocol. --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;https_port&gt;8443&lt;/https_port&gt;</span></span><br><span class="line"><span class="comment">    &lt;tcp_ssl_port&gt;9440&lt;/tcp_ssl_port&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Used with https_port and tcp_ssl_port. Full ssl options list: https://github.com/yandex/ClickHouse/blob/master/contrib/libpoco/NetSSL_OpenSSL/include/Poco/Net/SSLManager.h#L71 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">openSSL</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">server</span>&gt;</span> <span class="comment">&lt;!-- Used for https server AND secure tcp port --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- openssl req -subj "/CN=localhost" -new -newkey rsa:2048 -days 365 -nodes -x509 -keyout /etc/clickhouse-server/server.key -out /etc/clickhouse-server/server.crt --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">certificateFile</span>&gt;</span>/etc/clickhouse-server/server.crt<span class="tag">&lt;/<span class="name">certificateFile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">privateKeyFile</span>&gt;</span>/etc/clickhouse-server/server.key<span class="tag">&lt;/<span class="name">privateKeyFile</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- openssl dhparam -out /etc/clickhouse-server/dhparam.pem 4096 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dhParamsFile</span>&gt;</span>/etc/clickhouse-server/dhparam.pem<span class="tag">&lt;/<span class="name">dhParamsFile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">verificationMode</span>&gt;</span>none<span class="tag">&lt;/<span class="name">verificationMode</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">loadDefaultCAFile</span>&gt;</span>true<span class="tag">&lt;/<span class="name">loadDefaultCAFile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">cacheSessions</span>&gt;</span>true<span class="tag">&lt;/<span class="name">cacheSessions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">disableProtocols</span>&gt;</span>sslv2,sslv3<span class="tag">&lt;/<span class="name">disableProtocols</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">preferServerCiphers</span>&gt;</span>true<span class="tag">&lt;/<span class="name">preferServerCiphers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">client</span>&gt;</span> <span class="comment">&lt;!-- Used for connecting to https dictionary source --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">loadDefaultCAFile</span>&gt;</span>true<span class="tag">&lt;/<span class="name">loadDefaultCAFile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">cacheSessions</span>&gt;</span>true<span class="tag">&lt;/<span class="name">cacheSessions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">disableProtocols</span>&gt;</span>sslv2,sslv3<span class="tag">&lt;/<span class="name">disableProtocols</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">preferServerCiphers</span>&gt;</span>true<span class="tag">&lt;/<span class="name">preferServerCiphers</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Use for self-signed: &lt;verificationMode&gt;none&lt;/verificationMode&gt; --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">invalidCertificateHandler</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- Use for self-signed: &lt;name&gt;AcceptCertificateHandler&lt;/name&gt; --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>RejectCertificateHandler<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">invalidCertificateHandler</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">client</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">openSSL</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Default root page on http[s] server. For example load UI from https://tabix.io/ when opening http://localhost:8123 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;http_server_default_response&gt;&lt;![CDATA[&lt;html ng-app="SMI2"&gt;&lt;head&gt;&lt;base href="http://ui.tabix.io/"&gt;&lt;/head&gt;&lt;body&gt;&lt;div ui-view="" class="content-ui"&gt;&lt;/div&gt;&lt;script src="http://loader.tabix.io/master.js"&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;]]&gt;&lt;/http_server_default_response&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Port for communication between replicas. Used for data exchange. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interserver_http_port</span>&gt;</span>9009<span class="tag">&lt;/<span class="name">interserver_http_port</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Hostname that is used by other replicas to request this server.</span></span><br><span class="line"><span class="comment">         If not specified, than it is determined analoguous to 'hostname -f' command.</span></span><br><span class="line"><span class="comment">         This setting could be used to switch replication to another network interface.</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;interserver_http_host&gt;example.yandex.ru&lt;/interserver_http_host&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Listen specified host. use :: (wildcard IPv6 address), if you want to accept connections both with IPv4 and IPv6 from everywhere. --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;listen_host&gt;::&lt;/listen_host&gt; --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Same for hosts with disabled ipv6: --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;listen_host&gt;0.0.0.0&lt;/listen_host&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Default values - try listen localhost on ipv4 and ipv6: --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;listen_host&gt;::1&lt;/listen_host&gt;</span></span><br><span class="line"><span class="comment">    &lt;listen_host&gt;127.0.0.1&lt;/listen_host&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_connections</span>&gt;</span>4096<span class="tag">&lt;/<span class="name">max_connections</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keep_alive_timeout</span>&gt;</span>3<span class="tag">&lt;/<span class="name">keep_alive_timeout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Maximum number of concurrent queries. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_concurrent_queries</span>&gt;</span>100<span class="tag">&lt;/<span class="name">max_concurrent_queries</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Set limit on number of open files (default: maximum). This setting makes sense on Mac OS X because getrlimit() fails to retrieve</span></span><br><span class="line"><span class="comment">         correct maximum value. --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;max_open_files&gt;262144&lt;/max_open_files&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Size of cache of uncompressed blocks of data, used in tables of MergeTree family.</span></span><br><span class="line"><span class="comment">         In bytes. Cache is single for server. Memory is allocated only on demand.</span></span><br><span class="line"><span class="comment">         Cache is used when 'use_uncompressed_cache' user setting turned on (off by default).</span></span><br><span class="line"><span class="comment">         Uncompressed cache is advantageous only for very short queries and in rare cases.</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uncompressed_cache_size</span>&gt;</span>8589934592<span class="tag">&lt;/<span class="name">uncompressed_cache_size</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Approximate size of mark cache, used in tables of MergeTree family.</span></span><br><span class="line"><span class="comment">         In bytes. Cache is single for server. Memory is allocated only on demand.</span></span><br><span class="line"><span class="comment">         You should not lower this value.</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mark_cache_size</span>&gt;</span>5368709120<span class="tag">&lt;/<span class="name">mark_cache_size</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Path to data directory, with trailing slash. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span>&gt;</span>/var/lib/clickhouse/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Path to temporary data for processing hard queries. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tmp_path</span>&gt;</span>/var/lib/clickhouse/tmp/<span class="tag">&lt;/<span class="name">tmp_path</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Path to configuration file with users, access rights, profiles of settings, quotas. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">users_config</span>&gt;</span>users.xml<span class="tag">&lt;/<span class="name">users_config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;users&gt;</span></span><br><span class="line"><span class="comment">    &lt;default&gt;</span></span><br><span class="line"><span class="comment">            &lt;password_sha256_hex&gt;8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92&lt;/password_sha256_hex&gt;</span></span><br><span class="line"><span class="comment">            &lt;networks incl="networks" replace="replace"&gt;</span></span><br><span class="line"><span class="comment">                &lt;ip&gt;127.0.0.1/0&lt;/ip&gt;</span></span><br><span class="line"><span class="comment">            &lt;/networks&gt;</span></span><br><span class="line"><span class="comment">            &lt;profile&gt;default&lt;/profile&gt;</span></span><br><span class="line"><span class="comment">            &lt;quota&gt;default&lt;/quota&gt;</span></span><br><span class="line"><span class="comment">        &lt;/default&gt;</span></span><br><span class="line"><span class="comment">        &lt;ck&gt;</span></span><br><span class="line"><span class="comment">            &lt;password_sha256_hex&gt;8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92&lt;/password_sha256_hex&gt;</span></span><br><span class="line"><span class="comment">            &lt;networks incl="networks" replace="replace"&gt;</span></span><br><span class="line"><span class="comment">                &lt;ip&gt;::/0&lt;/ip&gt;</span></span><br><span class="line"><span class="comment">            &lt;/networks&gt;</span></span><br><span class="line"><span class="comment">            &lt;profile&gt;readonly&lt;/profile&gt;</span></span><br><span class="line"><span class="comment">            &lt;quota&gt;default&lt;/quota&gt;</span></span><br><span class="line"><span class="comment">        &lt;/ck&gt;</span></span><br><span class="line"><span class="comment">    &lt;/users&gt; --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Default profile of settings.. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default_profile</span>&gt;</span>default<span class="tag">&lt;/<span class="name">default_profile</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Default database. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default_database</span>&gt;</span>default<span class="tag">&lt;/<span class="name">default_database</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Server time zone could be set here.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         Time zone is used when converting between String and DateTime types,</span></span><br><span class="line"><span class="comment">          when printing DateTime in text formats and parsing DateTime from text,</span></span><br><span class="line"><span class="comment">          it is used in date and time related functions, if specific time zone was not passed as an argument.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         Time zone is specified as identifier from IANA time zone database, like UTC or Africa/Abidjan.</span></span><br><span class="line"><span class="comment">         If not specified, system time zone at server startup is used.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         Please note, that server could display time zone alias instead of specified name.</span></span><br><span class="line"><span class="comment">         Example: W-SU is an alias for Europe/Moscow and Zulu is an alias for UTC.</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">timezone</span>&gt;</span>Asia/Shanghai<span class="tag">&lt;/<span class="name">timezone</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- You can specify umask here (see "man umask"). Server will apply it on startup.</span></span><br><span class="line"><span class="comment">         Number is always parsed as octal. Default umask is 027 (other users cannot read logs, data files, etc; group can only read).</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;umask&gt;022&lt;/umask&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Configuration of clusters that could be used in Distributed tables.</span></span><br><span class="line"><span class="comment">         https://clickhouse.yandex/reference_en.html#Distributed</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">remote_servers</span> <span class="attr">incl</span>=<span class="string">"clickhouse_remote_servers"</span> &gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Test only shard config for testing distributed storage --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">test_shard_localhost</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>localhost<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">test_shard_localhost</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">remote_servers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- If element has 'incl' attribute, then for it's value will be used corresponding substitution from another file.</span></span><br><span class="line"><span class="comment">         By default, path to file with substitutions is /etc/metrika.xml. It could be changed in config in 'include_from' element.</span></span><br><span class="line"><span class="comment">         Values for substitutions are specified in /yandex/name_of_substitution elements in that file.</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ZooKeeper is used to store metadata about replicas, when using Replicated tables.</span></span><br><span class="line"><span class="comment">         Optional. If you don't use replicated tables, you could omit that.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         See https://clickhouse.yandex/reference_en.html#Data%20replication</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">zookeeper</span> <span class="attr">incl</span>=<span class="string">"zookeeper-servers"</span> <span class="attr">optional</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Substitutions for parameters of replicated tables.</span></span><br><span class="line"><span class="comment">          Optional. If you don't use replicated tables, you could omit that.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         See https://clickhouse.yandex/reference_en.html#Creating%20replicated%20tables</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">macros</span> <span class="attr">incl</span>=<span class="string">"macros"</span> <span class="attr">optional</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Reloading interval for embedded dictionaries, in seconds. Default: 3600. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">builtin_dictionaries_reload_interval</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">builtin_dictionaries_reload_interval</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Maximum session timeout, in seconds. Default: 3600. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_session_timeout</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">max_session_timeout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Default session timeout, in seconds. Default: 60. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default_session_timeout</span>&gt;</span>60<span class="tag">&lt;/<span class="name">default_session_timeout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Sending data to Graphite for monitoring. Several sections can be defined. --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        interval - send every X second</span></span><br><span class="line"><span class="comment">        root_path - prefix for keys</span></span><br><span class="line"><span class="comment">        hostname_in_path - append hostname to root_path (default = true)</span></span><br><span class="line"><span class="comment">        metrics - send data from table system.metrics</span></span><br><span class="line"><span class="comment">        events - send data from table system.events</span></span><br><span class="line"><span class="comment">        asynchronous_metrics - send data from table system.asynchronous_metrics</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;graphite&gt;</span></span><br><span class="line"><span class="comment">        &lt;host&gt;localhost&lt;/host&gt;</span></span><br><span class="line"><span class="comment">        &lt;port&gt;42000&lt;/port&gt;</span></span><br><span class="line"><span class="comment">        &lt;timeout&gt;0.1&lt;/timeout&gt;</span></span><br><span class="line"><span class="comment">        &lt;interval&gt;60&lt;/interval&gt;</span></span><br><span class="line"><span class="comment">        &lt;root_path&gt;one_min&lt;/root_path&gt;</span></span><br><span class="line"><span class="comment">        &lt;hostname_in_path&gt;true&lt;hostname_in_path&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        &lt;metrics&gt;true&lt;/metrics&gt;</span></span><br><span class="line"><span class="comment">        &lt;events&gt;true&lt;/events&gt;</span></span><br><span class="line"><span class="comment">        &lt;asynchronous_metrics&gt;true&lt;/asynchronous_metrics&gt;</span></span><br><span class="line"><span class="comment">    &lt;/graphite&gt;</span></span><br><span class="line"><span class="comment">    &lt;graphite&gt;</span></span><br><span class="line"><span class="comment">        &lt;host&gt;localhost&lt;/host&gt;</span></span><br><span class="line"><span class="comment">        &lt;port&gt;42000&lt;/port&gt;</span></span><br><span class="line"><span class="comment">        &lt;timeout&gt;0.1&lt;/timeout&gt;</span></span><br><span class="line"><span class="comment">        &lt;interval&gt;1&lt;/interval&gt;</span></span><br><span class="line"><span class="comment">        &lt;root_path&gt;one_sec&lt;/root_path&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        &lt;metrics&gt;true&lt;/metrics&gt;</span></span><br><span class="line"><span class="comment">        &lt;events&gt;true&lt;/events&gt;</span></span><br><span class="line"><span class="comment">        &lt;asynchronous_metrics&gt;false&lt;/asynchronous_metrics&gt;</span></span><br><span class="line"><span class="comment">    &lt;/graphite&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Query log. Used only for queries with setting log_queries = 1. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">query_log</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- What table to insert data. If table is not exist, it will be created.</span></span><br><span class="line"><span class="comment">             When query log structure is changed after system update,</span></span><br><span class="line"><span class="comment">              then old table will be renamed and new table will be created automatically.</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">database</span>&gt;</span>system<span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span>query_log<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Interval of flushing data. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flush_interval_milliseconds</span>&gt;</span>7500<span class="tag">&lt;/<span class="name">flush_interval_milliseconds</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">query_log</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Uncomment if use part_log</span></span><br><span class="line"><span class="comment">    &lt;part_log&gt;</span></span><br><span class="line"><span class="comment">        &lt;database&gt;system&lt;/database&gt;</span></span><br><span class="line"><span class="comment">        &lt;table&gt;part_log&lt;/table&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        &lt;flush_interval_milliseconds&gt;7500&lt;/flush_interval_milliseconds&gt;</span></span><br><span class="line"><span class="comment">    &lt;/part_log&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Parameters for embedded dictionaries, used in Yandex.Metrica.</span></span><br><span class="line"><span class="comment">         See https://clickhouse.yandex/reference_en.html#Internal%20dictionaries</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Path to file with region hierarchy. --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;path_to_regions_hierarchy_file&gt;/opt/geo/regions_hierarchy.txt&lt;/path_to_regions_hierarchy_file&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Path to directory with files containing names of regions --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;path_to_regions_names_files&gt;/opt/geo/&lt;/path_to_regions_names_files&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Configuration of external dictionaries. See:</span></span><br><span class="line"><span class="comment">         https://clickhouse.yandex/reference_en.html#External%20Dictionaries</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dictionaries_config</span>&gt;</span>*_dictionary.xml<span class="tag">&lt;/<span class="name">dictionaries_config</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Uncomment if you want data to be compressed 30-100% better.</span></span><br><span class="line"><span class="comment">         Don't do that if you just started using ClickHouse.</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">compression</span> <span class="attr">incl</span>=<span class="string">"clickhouse_compression"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        &lt;!- - Set of variants. Checked in order. Last matching case wins. If nothing matches, lz4 will be used. - -&gt;</span></span><br><span class="line"><span class="comment">        &lt;case&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            &lt;!- - Conditions. All must be satisfied. Some conditions may be omitted. - -&gt;</span></span><br><span class="line"><span class="comment">            &lt;min_part_size&gt;10000000000&lt;/min_part_size&gt;        &lt;!- - Min part size in bytes. - -&gt;</span></span><br><span class="line"><span class="comment">            &lt;min_part_size_ratio&gt;0.01&lt;/min_part_size_ratio&gt;   &lt;!- - Min size of part relative to whole table size. - -&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            &lt;!- - What compression method to use. - -&gt;</span></span><br><span class="line"><span class="comment">            &lt;method&gt;zstd&lt;/method&gt;</span></span><br><span class="line"><span class="comment">        &lt;/case&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">compression</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Allow to execute distributed DDL queries (CREATE, DROP, ALTER, RENAME) on cluster.</span></span><br><span class="line"><span class="comment">         Works only if ZooKeeper is enabled. Comment it if such functionality isn't required. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">distributed_ddl</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Path in ZooKeeper to queue with DDL queries --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span>&gt;</span>/clickhouse/task_queue/ddl<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">distributed_ddl</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Settings to fine tune MergeTree tables. See documentation in source code, in MergeTreeSettings.h --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;merge_tree&gt;</span></span><br><span class="line"><span class="comment">        &lt;max_suspicious_broken_parts&gt;5&lt;/max_suspicious_broken_parts&gt;</span></span><br><span class="line"><span class="comment">    &lt;/merge_tree&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Protection from accidental DROP.</span></span><br><span class="line"><span class="comment">         If size of a MergeTree table is greater than max_table_size_to_drop (in bytes) than table could not be dropped with any DROP query.</span></span><br><span class="line"><span class="comment">         If you want do delete one table and don't want to restart clickhouse-server, you could create special file &lt;clickhouse-path&gt;/flags/force_drop_table and make DROP once.</span></span><br><span class="line"><span class="comment">         By default max_table_size_to_drop is 50GB, max_table_size_to_drop=0 allows to DROP any tables.</span></span><br><span class="line"><span class="comment">         Uncomment to disable protection.</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;max_table_size_to_drop&gt;0&lt;/max_table_size_to_drop&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Example of parameters for GraphiteMergeTree table engine --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">graphite_rollup_example</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">regexp</span>&gt;</span>click_cost<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">function</span>&gt;</span>any<span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">retention</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">age</span>&gt;</span>0<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">precision</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">precision</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">retention</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">retention</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">age</span>&gt;</span>86400<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">precision</span>&gt;</span>60<span class="tag">&lt;/<span class="name">precision</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">retention</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">function</span>&gt;</span>max<span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">retention</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">age</span>&gt;</span>0<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">precision</span>&gt;</span>60<span class="tag">&lt;/<span class="name">precision</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">retention</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">retention</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">age</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">precision</span>&gt;</span>300<span class="tag">&lt;/<span class="name">precision</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">retention</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">retention</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">age</span>&gt;</span>86400<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">precision</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">precision</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">retention</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">graphite_rollup_example</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Directory in &lt;clickhouse-path&gt; containing schema files for various input formats.</span></span><br><span class="line"><span class="comment">         The directory will be created if it doesn't exist.</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">format_schema_path</span>&gt;</span>/var/lib/clickhouse/format_schemas/<span class="tag">&lt;/<span class="name">format_schema_path</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3、users-xml文件内容"><a href="#3、users-xml文件内容" class="headerlink" title="3、users.xml文件内容"></a>3、users.xml文件内容</h3><p>​        clickhouse-server中users.xml文件表示了对其服务的用户及权限的设置，本次文件也在默认配置下进行了修改，具体每个配置代表的意义可以参考<a href="%5Bhttps://schnappi618.github.io/2020/03/28/clickhouse%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/%5D(https://schnappi618.github.io/2020/03/28/clickhouse%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/)">clickhouse用户配置详解</a>，内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Profiles of settings. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Default settings. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Maximum memory usage for processing single query, in bytes. --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage</span>&gt;</span>10000000000<span class="tag">&lt;/<span class="name">max_memory_usage</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- Use cache of uncompressed blocks of data. Meaningful only for processing many of very short queries. --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">use_uncompressed_cache</span>&gt;</span>0<span class="tag">&lt;/<span class="name">use_uncompressed_cache</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- How to choose between replicas during distributed query processing.</span></span><br><span class="line"><span class="comment">                 random - choose random replica from set of replicas with minimum number of errors</span></span><br><span class="line"><span class="comment">                 nearest_hostname - from set of replicas with minimum number of errors, choose replica</span></span><br><span class="line"><span class="comment">                  with minumum number of different symbols between replica's hostname and local hostname</span></span><br><span class="line"><span class="comment">                  (Hamming distance).</span></span><br><span class="line"><span class="comment">                 in_order - first live replica is choosen in specified order.</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">load_balancing</span>&gt;</span>random<span class="tag">&lt;/<span class="name">load_balancing</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Profile that allows only read queries. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">readonly</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">readonly</span>&gt;</span>1<span class="tag">&lt;/<span class="name">readonly</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">readonly</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Users and ACL. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- If user name was not specified, 'default' user is used. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Password could be specified in plaintext or in SHA256 (in hex format).</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                 If you want to specify password in plaintext (not recommended), place it in 'password' element.</span></span><br><span class="line"><span class="comment">                 Example: &lt;password&gt;qwerty&lt;/password&gt;.</span></span><br><span class="line"><span class="comment">                 Password could be empty.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                 If you want to specify SHA256, place it in 'password_sha256_hex' element.</span></span><br><span class="line"><span class="comment">                 Example: &lt;password_sha256_hex&gt;65e84be33532fb784c48129675f9eff3a682b27168c0ea744b2cf58ee02337c5&lt;/password_sha256_hex&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                 How to generate decent password:</span></span><br><span class="line"><span class="comment">                 Execute: PASSWORD=$(base64 &lt; /dev/urandom | head -c8); echo "$PASSWORD"; echo -n "$PASSWORD" | sha256sum | tr -d '-'</span></span><br><span class="line"><span class="comment">                 In first line will be password and in second - corresponding SHA256.</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password</span>&gt;</span><span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- List of networks with open access.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                 To open access from everywhere, specify:</span></span><br><span class="line"><span class="comment">                    &lt;ip&gt;::/0&lt;/ip&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                 To open access only from localhost, specify:</span></span><br><span class="line"><span class="comment">                    &lt;ip&gt;::1&lt;/ip&gt;</span></span><br><span class="line"><span class="comment">                    &lt;ip&gt;127.0.0.1&lt;/ip&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                 Each element of list has one of the following forms:</span></span><br><span class="line"><span class="comment">                 &lt;ip&gt; IP-address or network mask. Examples: 213.180.204.3 or 10.0.0.1/8 or 2a02:6b8::3 or 2a02:6b8::3/64.</span></span><br><span class="line"><span class="comment">                 &lt;host&gt; Hostname. Example: server01.yandex.ru.</span></span><br><span class="line"><span class="comment">                     To check access, DNS query is performed, and all received addresses compared to peer address.</span></span><br><span class="line"><span class="comment">                 &lt;host_regexp&gt; Regular expression for host names. Example, ^server\d\d-\d\d-\d\.yandex\.ru$</span></span><br><span class="line"><span class="comment">                     To check access, DNS PTR query is performed for peer address and then regexp is applied.</span></span><br><span class="line"><span class="comment">                     Then, for result of PTR query, another DNS query is performed and all received addresses compared to peer address.</span></span><br><span class="line"><span class="comment">                     Strongly recommended that regexp is ends with $</span></span><br><span class="line"><span class="comment">                 All results of DNS requests are cached till server restart.</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networks</span> <span class="attr">incl</span>=<span class="string">"networks"</span> <span class="attr">replace</span>=<span class="string">"replace"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::1<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ip</span>&gt;</span>127.0.0.1<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- Settings profile for user. --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span>default<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- Quota for user. --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Example of user with readonly access. 说明：下面有两个用户seluser（readonly表示只读权限）和inuser（default表示默认权限）密码如下 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">seluser</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password</span>&gt;</span>meiyoumima<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networks</span> <span class="attr">incl</span>=<span class="string">"networks"</span> <span class="attr">replace</span>=<span class="string">"replace"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span>readonly<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">seluser</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">inuser</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password</span>&gt;</span>meiyoumima<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networks</span> <span class="attr">incl</span>=<span class="string">"networks"</span> <span class="attr">replace</span>=<span class="string">"replace"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span>default<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">inuser</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Quotas. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">quotas</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Name of quota. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Limits for time interval. You could specify many intervals with different limits. --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">interval</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- Length of interval. --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">duration</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">duration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">&lt;!-- No limits. Just calculate resource usage for time interval. --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">queries</span>&gt;</span>0<span class="tag">&lt;/<span class="name">queries</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">errors</span>&gt;</span>0<span class="tag">&lt;/<span class="name">errors</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">result_rows</span>&gt;</span>0<span class="tag">&lt;/<span class="name">result_rows</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">read_rows</span>&gt;</span>0<span class="tag">&lt;/<span class="name">read_rows</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution_time</span>&gt;</span>0<span class="tag">&lt;/<span class="name">execution_time</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">interval</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">quotas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="三、启动并测试服务"><a href="#三、启动并测试服务" class="headerlink" title="三、启动并测试服务"></a>三、启动并测试服务</h2><h3 id="1、启动服务"><a href="#1、启动服务" class="headerlink" title="1、启动服务"></a>1、启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动该服务，docker-compose表示创建并启动该容器，-d表示放入后台</span></span><br><span class="line">[rootxxxx docker_compose]<span class="comment"># docker-compose up -d</span></span><br><span class="line">Creating clickhouse-server_1 ... <span class="keyword">done</span></span><br><span class="line"><span class="comment"># 查看启动状态</span></span><br><span class="line">[rootxxxx docker_compose]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE                        COMMAND             CREATED             STATUS              PORTS                                                                              NAMES</span><br><span class="line">92b25e101be0        clickhouse-server-demo:1.0   <span class="string">"/entrypoint.sh"</span>    3 seconds ago       Up 2 seconds        0.0.0.0:8123-&gt;8123/tcp, 0.0.0.0:9000-&gt;9000/tcp, 0.0.0.0:9004-&gt;9004/tcp, 9009/tcp   clickhouse-server_1</span><br></pre></td></tr></table></figure>

<h3 id="2、测试用户配置"><a href="#2、测试用户配置" class="headerlink" title="2、测试用户配置"></a>2、测试用户配置</h3><p>​        从users.xml文件中可以看到创建了一个用户名为seluser，密码为meiyoumima的只读用户，这里通过该用户是否可以登陆服务，并且权限是否正确进行简单的测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过对外暴露的tcp端口9000使用clickhouse-client登陆测试</span></span><br><span class="line"><span class="comment">## 1. seluser只读用户登陆</span></span><br><span class="line">[rootxxxx docker_compose]<span class="comment"># docker run -it --rm --link clickhouse-server_1:docker_compose --net docker_compose_default clickhouse-server-demo:1.0 usr/bin/clickhouse-client --host docker_compose --user seluser --password meiyoumima</span></span><br><span class="line">ClickHouse client version 20.3.4.10 (official build).</span><br><span class="line">Connecting to docker_compose:9000 as user seluser.</span><br><span class="line">Connected to ClickHouse server version 20.3.4 revision 54433.</span><br><span class="line"></span><br><span class="line">clickhouse-server_1 :) show databases</span><br><span class="line"></span><br><span class="line">SHOW DATABASES</span><br><span class="line"></span><br><span class="line">┌─name────┐</span><br><span class="line">│ default │</span><br><span class="line">│ system  │</span><br><span class="line">└─────────┘</span><br><span class="line"></span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span>. Elapsed: 0.002 sec. </span><br><span class="line"></span><br><span class="line">clickhouse-server_1 :) create database <span class="built_in">test</span>		<span class="comment"># 可以看到由于seluser是个readonly的用户，所以无法创建数据库</span></span><br><span class="line"></span><br><span class="line">CREATE DATABASE <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">Received exception from server (version 20.3.4):</span><br><span class="line">Code: 164. DB::Exception: Received from docker_compose:9000. DB::Exception: seluser: Cannot execute query <span class="keyword">in</span> <span class="built_in">readonly</span> mode. </span><br><span class="line"></span><br><span class="line">0 rows <span class="keyword">in</span> <span class="built_in">set</span>. Elapsed: 0.071 sec. </span><br><span class="line"></span><br><span class="line">clickhouse-server_1 :) </span><br><span class="line"></span><br><span class="line"><span class="comment">## 2. inuser读写用户登陆</span></span><br><span class="line">[rootxxxx docker_compose]<span class="comment"># docker run -it --rm --link clickhouse-server_1:docker_compose --net docker_compose_default clickhouse-server-demo:1.0 usr/bin/clickhouse-client --host docker_compose --user inuser --password meiyoumima </span></span><br><span class="line">ClickHouse client version 20.3.4.10 (official build).</span><br><span class="line">Connecting to docker_compose:9000 as user inuser.</span><br><span class="line">Connected to ClickHouse server version 20.3.4 revision 54433.</span><br><span class="line"></span><br><span class="line">clickhouse-server_1 :) create database <span class="built_in">test</span>			<span class="comment"># inuser读写用户创建test库成功</span></span><br><span class="line"></span><br><span class="line">CREATE DATABASE <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">Ok.</span><br><span class="line"></span><br><span class="line">0 rows <span class="keyword">in</span> <span class="built_in">set</span>. Elapsed: 0.001 sec. </span><br><span class="line"></span><br><span class="line">clickhouse-server_1 :) show databases</span><br><span class="line"></span><br><span class="line">SHOW DATABASES</span><br><span class="line"></span><br><span class="line">┌─name────┐</span><br><span class="line">│ default │</span><br><span class="line">│ system  │</span><br><span class="line">│ <span class="built_in">test</span>    │</span><br><span class="line">└─────────┘</span><br><span class="line"></span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span>. Elapsed: 0.002 sec.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、从上面的config.xml中可以看到开启了其他远程主机通过mysql登陆的方法，端口为9004</span></span><br><span class="line">[rootxxxx ~]</span><br><span class="line">$ mysql -h xx.xx.xx.xx -P9004 -u seluser -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 3</span><br><span class="line">Server version: 20.3.4.10-ClickHouse </span><br><span class="line"></span><br><span class="line">Copyright (c) 2009-2017 Percona LLC and/or its affiliates</span><br><span class="line">Copyright (c) 2000, 2017, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">'\c'</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+---------+</span><br><span class="line">| name    |</span><br><span class="line">+---------+</span><br><span class="line">| default |</span><br><span class="line">| system  |</span><br><span class="line">| <span class="built_in">test</span>    |</span><br><span class="line">+---------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create database zztest;</span><br><span class="line">ERROR 164 (00000): seluser: Cannot execute query <span class="keyword">in</span> <span class="built_in">readonly</span> mode</span><br></pre></td></tr></table></figure>


        </div>

        <div class="article-nav">
            
                <div class="article-prev">
                    <a class="prev btn"
                       rel="prev"
                       href="/2020/03/28/harbor/harbor%E6%90%AD%E5%BB%BAdocker%E7%A7%81%E6%9C%89%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93/"
                    >
                        <i class="fa fa-chevron-left"></i> <span class="post-nav-title-item">harbor搭建docker私有镜像仓库</span><span class="post-nav-item">Prev posts</span>
                    </a>
                </div>
            
            
                <div class="article-next">
                    <a class="next btn"
                       rel="next"
                       href="/2020/03/21/clickhouse/clickhouse%E7%9A%84docker%E6%9E%B6%E6%9E%84/"
                    >
                        <span class="post-nav-title-item">clickhouse的docker架构</span><span class="post-nav-item">Next posts</span> <i class="fa fa-chevron-right"></i>
                    </a>
                </div>
            
        </div>

        <div class="comment-container">
            <div class="comments-container">
    
</div>
        </div>
    </div>
</div>

    <div class="article-toc-container fade-in-down-animation">
        <div class="article-toc">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、docker-compose简介"><span class="nav-text">一、docker-compose简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、什么是docker-compose"><span class="nav-text">1、什么是docker-compose</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、docker-compose安装"><span class="nav-text">2、docker-compose安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、docker-compose定制clickhouse配置"><span class="nav-text">二、docker-compose定制clickhouse配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、文件结构"><span class="nav-text">1、文件结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、docker-compose-yml文件内容"><span class="nav-text">2、docker-compose.yml文件内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3、config-xml文件内容"><span class="nav-text">3、config.xml文件内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3、users-xml文件内容"><span class="nav-text">3、users.xml文件内容</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、启动并测试服务"><span class="nav-text">三、启动并测试服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、启动服务"><span class="nav-text">1、启动服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、测试用户配置"><span class="nav-text">2、测试用户配置</span></a></li></ol></li></ol>
    </div>
</div>
        </div>
    </div>


                

            </div>

            

        </main>

        <div class="sidebar-tools">
            <div class="tools-container">
    <ul class="tools-list">
        
            <li class="search popup-trigger">
                <i class="fa fa-search"></i>
            </li>
            
<script src="/js/local-search.js"></script>

        
        <li class="mode-toggle">
            <i class="fa fa-moon-o"></i>
        </li>
        
            <li class="rss">
                <a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a>
            </li>
        
    </ul>
</div>

        </div>

        
            <div class="scroll-to-top">
                <ul>
                    <li>
                        <!--<i class="fa fa-caret-up"></i>-->
                        <span class="scroll-percent"></span>
                    </li>
                </ul>
            </div>
        
    </div>

    <div class="page-bottom">
        <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy; 2021 <a href="/">schnappi618</a>
        </div>
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a> | Theme <a
                    href="https://github.com/XPoet/hexo-theme-ils" target="_blank">ILS v1.1.2</a>
        </div>
        
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv" style="display: none">
                        UV<span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" style="display: none">
                        PV<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
</div>

    <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-icon">
            <i class="fa fa-search"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fa fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>


<script src="/js/main.js"></script>
<script src="/js/header-shrink.js"></script>
<script src="/js/toggle-mode.js"></script>



    
<script src="/js/scroll-to-top.js"></script>





    
        
<script src="/js/code-copy.js"></script>

    

    
        
<script src="/lib/anime.min.js"></script>
<script src="/js/toc.js"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

    




</body>
</html>